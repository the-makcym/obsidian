### CTE
Обобщенное табличное выражение или CTE (Common Table Expressions) - это временный результирующий набор данных, к которому можно обращаться в последующих запросах. Для написания обощенного табличного выражения используется оператор WITH. То есть, запросом мы достаем данные, и они помещаются в пространство памяти, аналогично временному представлению, которое физически не сохраняется в виде объектов.

```
WITH cte[(columns)] as (
	SELECT ...
)
SELECT ...
```

Основные способы использования:

-   для улучшения читаемости запроса в случае сложных запросов (разительно уменьшают размер кода)
-   в случаях, когда нужно много раз обращаться к одним и тем же таблицам/выборкам из таблиц
-   для написания рекурсивных запросов

Отличия от вложенного запроса:
-   вложенный запрос повторяется для каждой строки из нашей выборки, что повышает стоимость выполнения запроса

##### Произвольная вложенность

```
WITH
	cte_1[(columns_1)] as (
		WITH subcte[(columns)] as (
			SELECT ...
		)
		SELECT columns_1 ...
	),
	cte_2[(columns_2)] as (
		SELECT columns_2 ...
	)
SELECT ...
```

##### Рекурсия

```
WITH RECURSIVE cte as (
	SELECT ... 					-- anchor	
		UNION / INTERSECT / EXCEPT
	SELECT ...					-- recursive
)
SELECT ...
OPTION MAXRECURSION(n)
```

- Может быть определено несколько закрепленных элементов и рекурсивных элементов, однако все определения запросов закрепленного  должны быть поставлены перед первым определением рекурсивного 
- Количество столбцов, типы данных должно совпадать
- Предложение FROM рекурсивного элемента должно ссылаться на `cte` только один раз